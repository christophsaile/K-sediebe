---
import BaseLayout from '@layouts/BaseLayout.astro';
import Card from '@components/Card';
import { client } from '@lib/contentfulClient';
import type { IRecipeFields } from '@customTypes/generated/contentful';
import Pagination from '@components/Pagination.astro';
import BaseHeader from '@layouts/BaseHeader.astro';
import Like from '@components/Like';

export async function getStaticPaths({ paginate }) {
	const data = await client
		.getEntries<IRecipeFields>({
			content_type: 'recipe',
		})
		.then((entries) => entries.items)
		.catch(() => []);

	return paginate(data, { pageSize: 10 });
}

const { page } = Astro.props;
const title = 'Käsediebe Foodblog';
const description =
	'Käsediebe ist ein Foodblog in dem Christoph und Pauline ihre Rezepte vorstellen.';
const permalink = 'https://www.kaesediebe.netlify.app';
---

<BaseLayout
	title={`${title}${page.currentPage > 1 ? ' - ' + page.currentPage : ''}`}
	description={description}
	permalink={`${permalink}${page.currentPage > 1 && '/' + page.currentPage}`}
>
	<BaseHeader menu search />
	<main class='grid gap-6 max-w-md mx-auto mb-16 p-4 pt-8'>
		<div class='flex gap-2 items-center'>
			<svg
				xmlns='http://www.w3.org/2000/svg'
				class='h-6 w-6'
				fill='none'
				viewBox='0 0 24 24'
				stroke='currentColor'
				stroke-width='2'
			>
				<path
					stroke-linecap='round'
					stroke-linejoin='round'
					d='M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z'
				></path>
			</svg>
			<h2 class='text-4xl font-bold'>Rezepte</h2>
		</div>
		{page.data.map((entry, index: number) => (
			<Card data={entry.fields} cardNumber={index}>
				<Like data={entry.fields} client:idle />
			</Card>
		))}
		<Pagination currentPage={page.currentPage} totalPages={page.lastPage} />
	</main>
</BaseLayout>
